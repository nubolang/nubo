import thread from "@std/thread";

struct Site {
    domain: string
    statusCode: int
    status: string
}

event fetched(site: Site)

fn main(ctx: nubo.Ctx) -> void {
    sub fetched(site) {
        print(site)
    }

    const spawner = thread.spawner()

    for site in sites {
        spawner.spawn(fn() {
            let response = http.get(site.domain)
            site.statusCode = response.statusCode
            site.status = response.status
            pub fetched(site)
        })
    }

    spawner.await()
}
